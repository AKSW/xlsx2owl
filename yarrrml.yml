---
prefixes:
  spo: "https://w3id.org/steel/ProcessOntology/"
  spoi: "https://w3id.org/steel/ProcessOntologyInstances/"
  rdfs: "http://www.w3.org/2000/01/rdf-schema#"
  dc: "http://purl.org/dc/elements/1.1/"
  skos: "http://www.w3.org/2004/02/skos/core#"
  owl: "http://www.w3.org/2002/07/owl#"
  grel: "http://users.ugent.be/~bjdmeest/function/grel.ttl#"
  xsd: "http://www.w3.org/2001/XMLSchema#"
  emmo: "http://emmo.info/emmo#"
  pmdco: "https://material-digital.de/pmdco/"
  foaf: "http://xmlns.com/foaf/0.1/" 
base: "https://w3id.org/steel/ProcessOntology/"

mappings:

  ###
  # generating ontology metadata
  ###
  ontologyMetadata:
    sources: 
      - ['csv/OntologyMetadata.csv~csv']
   # subject: "spo:"
    subject:
      # remove trailing slash "/" from ontology prefix IRI
      function: "grel:string_chomp"
      parameters: 
        - parameter: "grel:valueParameter"
          value: 
            function: "http://w3id.org/steel/xlsx2owl-utils/functions.ttl#expandPrefix"
            parameters: 
            - ["grel:valueParameter", "spo:"]
        - ["grel:p_string_sep", "/"]
    po:
      - ["a", "owl:Ontology"]
      - [ ["rdfs:label", "skos:prefLabel"], "$(title-EN)", "en~lang"]
      - ["dc:description", "$(description-EN)", "en~lang"]
      - ["owl:versionInfo", "$(version-EN)", "en~lang"]
      - ["foaf:depiction", "spo:graph.png~iri"]


  ###
  # mappings for the **Classes** sheet
  ###
  classes:
    sources:
      - ['csv/Classes.csv~csv']
    ## **TODO:** test expandPrefix function
    ## **TODO:** add filter to create only classes in our own namespace
    ## **TODO:** we probably want to change 'spo' prefix to something like 'target' or use base prefix
    subject: "spo:$(id)"
    ### we need some handling for ids with other prefixes, but get NullPointer exception here
    # condition:
    #   function: "grel:string_contains"
    #   parameters:
    #     - [grel:valueParameter, "$(id)"]
    #     - [grel:string_sub, "\:"]
    po:
      ## simple direct mappings:
      - ["a", "owl:Class"]
      - ["rdfs:label", $(label-EN), "en~lang"]
      - ["rdfs:label", $(label-DE), "de~lang"]
      - ["skos:preflabel", $(label-EN), "en~lang"]
      - ["skos:preflabel", $(label-DE), "de~lang"]
      - ["rdfs:comment", $(description-EN), "en~lang"] # JOD prefers rdfs:comment instead of dc:description 

      ## mappings for maybe semicolon/comma separated values
      - p: "skos:altlabel"
        o:
#          function: "grel:string_split" ## throws NullPointerExceptions for every missing value
          function: "http://w3id.org/steel/xlsx2owl-utils/functions.ttl#split"
          parameters:
            - ["grel:valueParameter", "$(synonyms-EN)"]
            - ["grel:p_string_sep", ";"]
#          value: $(synonyms-EN)
          language: en
      - p: "skos:altlabel"
        o:
          function: "http://w3id.org/steel/xlsx2owl-utils/functions.ttl#split"
          parameters:
            - ["grel:valueParameter", "$(synonyms-DE)"]
            - ["grel:p_string_sep", ";"]
          value: $(synonyms-DE)
          language: de
      - p: "rdfs:subClassOf"
        o:
          function: "http://w3id.org/steel/xlsx2owl-utils/functions.ttl#splitAndExpandPrefixes"
          parameters:
            - ["grel:valueParameter", "$(parentClass)"]
            - ["grel:p_string_sep", ";"]
          type: iri
      - p: ["rdfs:seeAlso", "skos:related"]
        o:
          function: "http://w3id.org/steel/xlsx2owl-utils/functions.ttl#splitAndExpandPrefixes"
          parameters:
            - ["grel:valueParameter", "$(related)"]
            - ["grel:p_string_sep", ";"]
          type: iri

  ###
  # mappings for the **Relations** sheet
  ###
  objectProperties:
    sources:
      - ['csv/Relations.csv~csv']
    subject: "spo:$(id)"
    po:
      - ["a", "owl:ObjectProperty"]

      ## rdfs:label, skos:preflabel for en
      - ["rdfs:label", $(label-EN), en~lang]
      - [skos:preflabel, $(label-EN), en~lang]

      ## dc:description
      - [dc:description, $(description-EN), en~lang]

      ## domain and range
      ## **TODO:** use expandPrefix function
      - [rdfs:domain, spo:$(domain)~iri]
      ## **TODO:** use expandPrefix function
      - [rdfs:range, spo:$(range)~iri]

      ## synonyms
      - p: "skos:altlabel"
        o:
          function: "http://w3id.org/steel/xlsx2owl-utils/functions.ttl#split"
          parameters:
            - ["grel:valueParameter", "$(synonyms-EN)"]
            - ["grel:p_string_sep", ";"]
#          value: $(synonyms-EN)
          language: en
      ## **TODO:** add superProperty

  ###
  # mappings for the **Attributes** sheet
  ###
  DatatypeProperties:
    sources:
      - ['csv/Attributes.csv~csv']
    subject: "spo:$(id)"
    po:
      - ["a", "owl:DatatypeProperty"]

      ## rdfs:label, skos:preflabel for en
      - [rdfs:label, $(label-EN), en~lang]
      - [skos:preflabel, $(label-EN), en~lang]

      ## dc:description
      - [dc:description, $(description-EN), en~lang]

      ## domain and range
      ## **TODO:** use expandPrefix function
      - [rdfs:domain, spo:$(domain)~iri]
      ## **TODO:** use expandPrefix function
      - p: rdfs:range
        o:
          function: "http://w3id.org/steel/xlsx2owl-utils/functions.ttl#expandPrefix"
          parameters:
            - ["grel:valueParameter", "$(datatype)"]
#          value: "$(datatype)"
          type: iri ## causes error with rmlmapper 4.13 instead 4.10: "ERROR be.ugent.rml.cli.Main.main(389) - Not a valid (absolute) IRI:"
      ## **TODO:** add superProperty


###
# mapping of individuals and their relations+attributes
  Individuals:
    sources:
      - ['csv/Individuals.csv~csv']
    subject: "spoi:$(id)"
    po: 
      - [[rdfs:label, skos:preflabel], $(label-EN), en~lang]
      - [dc:description, $(description-EN), en~lang]
      - p: "a"
        o:
          function: "http://w3id.org/steel/xlsx2owl-utils/functions.ttl#expandPrefix"
          parameters:
            - ["grel:valueParameter", "$(type)"]
          type: iri

  IndRelations:
    sources:
      - ['csv/IndRelations.csv~csv']
    subject: "spoi:$(individual)" # duplicate subject iri with 'Individuals', but easier than mapping
    po:
      - p: "spo:$(relation)" # TODO: add support for other namespaces, the following is not working
      #- p: # got yarrrml error with predicate functions, see https://github.com/RMLio/yarrrml-parser/issues/178
      #    function: "http://w3id.org/steel/xlsx2owl-utils/functions.ttl#expandPrefix"
      #    parameters:
      #      - ["grel:valueParameter", "$(relation)"]
      #    type: iri
        o: "spoi:$(value-individual)" # ISSUE: only individuals within spoi are supported this way
        
  IndAttributes:
    sources:
      - ['csv/IndAttributes.csv~csv']
    subject: "spoi:$(individual)" # duplicate subject iri with 'Individuals', but easier than mapping
    po:
      - p: "spo:$(attribute)" # TODO: add support for other namespaces, the following is not working
      #- p: # got yarrrml error with predicate functions, see https://github.com/RMLio/yarrrml-parser/issues/178
      #    function: "http://w3id.org/steel/xlsx2owl-utils/functions.ttl#expandPrefix"
      #    parameters:
      #      - ["grel:valueParameter", "$(attribute)"]
      #    type: iri
        o: 
          value: "$(value)"
          # TODO: find a way to support datatype, see https://github.com/kg-construct/mapping-challenges/tree/main/challenges/datatype-map
          # got exception from yarrrml parser for the following:
          #datatype: 
          #  function: "http://w3id.org/steel/xlsx2owl-utils/functions.ttl#expandPrefix"
          #  parameters:
          #    - ["grel:valueParameter", "$(type)"]
          #  type: iri